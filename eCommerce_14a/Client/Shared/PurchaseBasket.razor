<div class="row">
    <a class="col-sm-2 font-weight-bold" href=Stores/@purchaseBasket.Store.StoreId>@purchaseBasket.Store.StoreName</a>
    <div class="col-sm-2">
        <label>Price: @purchaseBasket.Price&#8362</label>
    </div>
    <div class="col-sm-4">
        <button class="form-control col-1 btn btn-primary" style="display: flex; align-items: center;justify-content: center; height:24px; padding: 1px 1px;" @onclick="@(e => Collapse = !Collapse)">@( Collapse ? "+" : "-")</button>
    </div>
</div>
<div class="panel panel-default border @Collapsed">

    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Category</th>
                <th>Details</th>
                <th>Price</th>
                <th>Amount</th>
                @if (Modifiable)
                {
                    <th>Actions</th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (int productId in purchaseBasket.Product.Keys) 
            { 
            <tr>
                <ProductRow StoreId="@purchaseBasket.Store.StoreId" Product="@GetProduct(productId)" />
                <td>@purchaseBasket.Product[productId]</td>
                @if (Modifiable)
                {
                <th>
                    <a style="text-underline-position:below; cursor:pointer; color:blue" @onclick="(() => Remove(productId))">Remove</a>
                </th>
                }
            </tr>
            }
        </tbody>
    </table>
</div>

@code {
    [Parameter]
    public PurchaseBasketData purchaseBasket { get; set; }
    [Parameter]
    public bool Modifiable { get; set; }
    [Parameter]
    public bool Collapse { get; set; }

    protected override void OnInitialized()
    {
        Collapse = false;
    }

    public string Collapsed {
        get
        {
            return Collapse ? "collapse" : "";
        }
    }

    public ProductData GetProduct(int productId)
    {
        foreach (var productTuple in purchaseBasket.Store.Products.invProducts)
        {
            if (productTuple.Item1.ProductId == productId)
            {
                return productTuple.Item1;
            }
        }

        return null; // Reached?
    }

    public void Remove(int productId)
    {
        // TODO
    }


    // https://stackoverflow.com/questions/58538154/how-to-collapse-expand-razor-components-using-blazor-syntax

}
